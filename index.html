<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>åŒ–å¦å“ OEMï½œåŒ…è£åå¥½å¿«é€Ÿé‡æ¸…å™¨</title>
  <style>
    :root{
      /* ç±³ç™½ä¸»é¡Œï¼ˆä¼æ¥­ç°¡å ±å‹å–„ï¼‰ */
      --bg:#f6f3ee;              /* æ•´é«”èƒŒæ™¯ç±³ç™½ */
      --panel:#faf7f2;           /* å€å¡Šåº•è‰² */
      --card:#ffffff;            /* å¡ç‰‡ç´”ç™½ */
      --muted:#7a746b;           /* æ¬¡è¦æ–‡å­—ï¼ˆæš–ç°ï¼‰ */
      --text:#2f2b26;            /* ä¸»æ–‡å­—ï¼ˆæ·±ç°é»‘ï¼‰ */
      --line:rgba(0,0,0,.08);    /* é‚Šç·š */
      --good:#3aa981;
      --warn:#e2a93b;
      --bad:#d96b6b;
      --accent:#c9a86a;          /* é¦™æª³é‡‘ä½œç‚ºé‡é»è‰² */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #fbf9f5 0%, #f3efe8 100%);
      color:var(--text);
      padding:24px;
    }
    .wrap{max-width:1220px;margin:0 auto}
    header{
      display:flex;gap:16px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;
      margin-bottom:18px;
    }
    h1{font-size:22px;margin:0;letter-spacing:.2px}
    .sub{color:var(--muted);margin-top:6px;font-size:13px;line-height:1.5}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border:1px solid var(--line);
      border-radius:999px;background:rgba(255,255,255,.04);
      color:var(--muted);font-size:12px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
    }
    .card .hd{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      background: linear-gradient(180deg, #faf7f2, #f3efe8);
    }
    .card .hd b{font-size:14px}
    .card .bd{padding:14px 16px}
    .section{margin-bottom:14px}
    label{display:block;color:var(--muted);font-size:12px;margin:0 0 6px}
    input[type="text"], textarea, select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fffdf8;
      color:var(--text);
      outline:none;
    }
    textarea{min-height:88px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 560px){ .row{grid-template-columns:1fr} }
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{
      padding:8px 10px;border-radius:999px;border:1px solid var(--line);
      background:#fffdf8;color:var(--text);font-size:12px;
      cursor:pointer; user-select:none;
      transition: transform .05s ease, background .15s ease;
    }
    .chip:active{transform:scale(.98)}
    .chip.on{
      border-color: var(--accent);
      background: rgba(201,168,106,.18);
    }
    .mini{color:var(--muted);font-size:12px;line-height:1.55}
    .risk{
      display:flex;gap:8px;align-items:flex-start;
      padding:10px 12px;border-radius:12px;border:1px dashed var(--line);
      background: rgba(255,255,255,.03);
      margin-top:10px;
    }
    .dot{width:10px;height:10px;border-radius:999px;margin-top:5px}
    .dot.good{background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:#fffdf8;
      color: var(--text);
      cursor:pointer;
    }
    button.primary{
      border-color: var(--accent);
      background: rgba(201,168,106,.25);
    }
    button.danger{border-color: rgba(255,107,107,.55); background: rgba(255,107,107,.12)}
    pre{
      white-space:pre-wrap;
      word-break:break-word;
      background:#fbf9f5;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      margin:0;
      color:var(--text);
      font-size:12px;
      line-height:1.5;
    }
    .kv{
      display:grid;grid-template-columns: 120px 1fr;gap:8px 10px;
      font-size:12px;color:var(--text);
    }
    .kv div:nth-child(odd){color:var(--muted)}
    .footerNote{color:var(--muted);font-size:12px;margin-top:10px}
  </style>
  <style>
    /* Modal */
    .modalOverlay{
      position:fixed; inset:0; display:none;
      background:rgba(0,0,0,.55);
      align-items:center; justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(920px, 100%);
      background:#ffffff;
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow: 0 24px 80px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .modalHd{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .modalHd b{font-size:13px}
    .modalBd{padding:12px 14px}
    .modalBd textarea{
      width:100%; min-height:280px;
      background:#fbf9f5;
      border:1px solid var(--line);
      border-radius:12px;
      color:var(--text);
      padding:12px;
      font-size:12px;
      line-height:1.55;
    }
    .modalFt{padding:12px 14px; display:flex; gap:10px; flex-wrap:wrap; border-top:1px solid var(--line)}
    .xbtn{border:1px solid var(--line); background:rgba(255,255,255,.06); border-radius:10px; padding:8px 10px; cursor:pointer; color:var(--text)}
    .help{color:var(--muted); font-size:12px; line-height:1.55}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>åŒ–å¦å“ OEMï½œåŒ…è£åå¥½å¿«é€Ÿé‡æ¸…å™¨</h1>
      <div class="sub">
        çµ¦æ¥­ä¸»ç”¨çš„ã€Œé¸ä¸€é¸å°±èƒ½è¬›æ¸…æ¥šã€å·¥å…·ï¼š<br/>
        ç”¢å‡º <b>åŒ…è£åå¥½ Brief</b> ï¼‹ <b>GEMINI CANVAS Prompt</b>ï¼Œè®“ OEM åœ¨ä¸€é–‹å§‹å°±å°é½Šæ–¹å‘ï¼ˆå°‘èµ°å†¤æ‰è·¯ï¼‰ã€‚
      </div>
    </div>
    <div class="pill">âœ… å¯ç›´æ¥ç™¼ä½ˆï½œğŸ“„ å¯åŒ¯å‡º Markdownï½œğŸ§  è‡ªå‹•ç”Ÿ Prompt</div>
  </header>

  <div class="grid">
    <!-- Left: Form -->
    <div class="card">
      <div class="hd">
        <b>1) æ¥­ä¸»åå¥½å¡«å¯«</b>
        <span class="mini">å°æé†’ï¼šä½ é¸çš„ä¸æ˜¯ã€Œå¥½ä¸å¥½çœ‹ã€ï¼Œè€Œæ˜¯ã€Œæœªä¾†é‡ç”¢å¾Œåƒä¸åƒä½ å¿ƒä¸­çš„å“ç‰Œã€ã€‚</span>
      </div>
      <div class="bd">

        <div class="row">
          <div class="section">
            <label>å“ç‰Œ / å°ˆæ¡ˆåç¨±</label>
            <input id="brand" type="text" placeholder="ä¾‹ï¼šå¥‡ç•°ç”ŸæŠ€ï½œN ç³»åˆ— / æŸæŸå“ç‰Œæ–°å“" />
          </div>
          <div class="section">
            <label>ç”¢å“é¡å‹</label>
            <select id="ptype">
              <option>æ´—é«®ç²¾</option>
              <option>è­·é«® / é«®è†œ</option>
              <option>é ­çš®ç²¾è¯</option>
              <option>å®‰ç“¶</option>
              <option>è‡‰éƒ¨ç²¾è¯</option>
              <option>é¢éœœ</option>
              <option>åŒ–å¦æ°´</option>
              <option>å¸å¦ / æ¸…æ½”</option>
              <option>é˜²æ›¬</option>
              <option>èº«é«”ä¹³</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="section">
            <label>å“ç‰Œå®šä½ï¼ˆé¸ 1â€“2ï¼‰</label>
            <div class="chips" id="posChips"></div>
          </div>
          <div class="section">
            <label>ç›®æ¨™å®¢ç¾¤</label>
            <input id="aud" type="text" placeholder="ä¾‹ï¼š25â€“40 å¥³æ€§ï¼æ²™é¾å°ˆæ¥­äººå£«ï¼æ•å¼±è‚Œæ—ç¾¤" />
          </div>
        </div>

        <div class="section">
          <label>é€šè·¯ï¼ˆé¸ 1â€“2ï¼‰</label>
          <div class="chips" id="channelChips"></div>
        </div>

        <div class="row">
          <div class="section">
            <label>åŒ…è£å½¢å¼ï¼ˆé¸ 1â€“2ï¼‰</label>
            <div class="chips" id="packChips"></div>
          </div>
          <div class="section">
            <label>æè³ªåå¥½ï¼ˆé¸ 1â€“2ï¼‰</label>
            <div class="chips" id="matChips"></div>
          </div>
        </div>

        <div class="row">
          <div class="section">
            <label>è‰²ç³»åå¥½ï¼ˆå¯è¤‡é¸ï¼‰</label>
            <div class="chips" id="colorChips"></div>
          </div>
          <div class="section">
            <label>è³ªæ„Ÿèˆ‡æ°›åœï¼ˆé¸ 2â€“4ï¼‰</label>
            <div class="chips" id="moodChips"></div>
          </div>
        </div>

        <div class="row">
          <div class="section">
            <label>å­—é«” / æ’ç‰ˆé¢¨æ ¼ï¼ˆé¸ 1â€“2ï¼‰</label>
            <div class="chips" id="typeChips"></div>
          </div>
          <div class="section">
            <label>åœ–åƒèªè¨€ï¼ˆé¸ 1â€“2ï¼‰</label>
            <div class="chips" id="visualChips"></div>
          </div>
        </div>

        <div class="row">
          <div class="section">
            <label>ä½ æƒ³é¿å…çš„é¢¨æ ¼ï¼ˆé¸ 1â€“3ï¼‰</label>
            <div class="chips" id="avoidChips"></div>
          </div>
          <div class="section">
            <label>æˆåˆ† / ç§‘æŠ€å½¢è±¡ï¼ˆå¯å¡«ï¼‰</label>
            <input id="ing" type="text" placeholder="ä¾‹ï¼šæ¤èƒã€èƒœè‚½ã€æµ·æ´‹ä¾†æºã€èƒºåŸºé…¸ã€å¤–æ³Œé«”ï¼ˆæ³¨æ„åˆè¦ï¼‰" />
          </div>
        </div>

        <div class="section">
          <label>è£œå……å‚™è¨»ï¼ˆæ¥­ä¸»è‡ªç”±æè¿°ï¼‰</label>
          <textarea id="note" placeholder="ä¾‹ï¼šå¸Œæœ›æ›´åƒé†«ç¾è¨ºæ‰€çš„ä¿¡ä»»æ„Ÿï¼Œä½†ä¸è¦é†«ç™‚å™¨æ¢°æ„Ÿï¼›é¿å…éåº¦å°‘å¥³ï¼›å–œæ­¡ç•™ç™½èˆ‡éœ§é¢æè³ªã€‚"></textarea>
        </div>

        <div class="btns">
          <button class="primary" id="btnSample">å¥—ç”¨ç¤ºç¯„ï¼ˆæ²™é¾é«˜ç«¯ï¼‰</button>
          <button id="btnReset">æ¸…ç©ºé‡å¡«</button>
          <button class="danger" id="btnExport">åŒ¯å‡º Markdown å ±å‘Š</button>
          <button id="btnCopyPrompt">è¤‡è£½ GEMINI Prompt</button>
        </div>

        <div class="footerNote">
          ğŸ˜„ å‹æƒ…æé†’ï¼šå¦‚æœæ¥­ä¸»å‹¾é¸ã€Œé»‘é‡‘å¥¢è¯ã€åˆåŒæ™‚å‹¾ã€Œè¦ªæ°‘å¯æ„›ã€ï¼Œé‚£ä¸æ˜¯å“ç‰Œå®šä½ï¼Œé‚£æ˜¯äººæ ¼åˆ†è£‚â€”â€”æˆ‘å€‘æœƒåœ¨å³å´æé†’ä½ ã€‚
        </div>
      </div>
    </div>

    <!-- Right: Outputs -->
    <div class="card">
      <div class="hd">
        <b>2) ç”¢å‡ºï¼ˆå¯ç›´æ¥äº¤ä»˜ï¼‰</b>
        <span class="mini">å³æ™‚æ›´æ–°ï¼šBrief æ‘˜è¦ + åˆè¦æé†’ + GEMINI Prompt</span>
      </div>
      <div class="bd">

        <div class="section">
          <label>åŒ…è£åå¥½æ‘˜è¦ï¼ˆçµ¦æ±ºç­–è€… / å·¥å»  / è¨­è¨ˆï¼‰</label>
          <div class="kv" id="briefKv"></div>

          <div class="risk" id="riskBox">
            <div class="dot good" id="riskDot"></div>
            <div>
              <div style="font-size:12px;margin-bottom:4px;"><b id="riskTitle">é¢¨éšªç‹€æ…‹ï¼šè‰¯å¥½</b></div>
              <div class="mini" id="riskMsg">ç›®å‰é¸é …æ•´é«”ä¸€è‡´ï¼Œé©åˆç›´æ¥é€²å…¥è¦–è¦ºææ¡ˆã€‚</div>
            </div>
          </div>
        </div>

        <div class="section">
          <label>GEMINI CANVAS Promptï¼ˆå¯ç›´æ¥è²¼ï¼‰</label>
          <pre id="promptOut"></pre>
        </div>

        <div class="section">
          <label>Markdown å ±å‘Šé è¦½ï¼ˆåŒ¯å‡ºç”¨ï¼‰</label>
          <pre id="mdOut"></pre>
        </div>

      </div>
    </div>

  </div>
</div>

  <!-- Modal (fallback for download/copy restrictions) -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHd">
        <b id="modalTitle">è¼¸å‡ºå…§å®¹</b>
        <button class="xbtn" id="modalClose">é—œé–‰</button>
      </div>
      <div class="modalBd">
        <div class="help" id="modalHelp" style="margin-bottom:10px;">è‹¥ç€è¦½å™¨é™åˆ¶ä¸‹è¼‰/å‰ªè²¼ç°¿ï¼Œè«‹åœ¨æ­¤æ‰‹å‹•è¤‡è£½æˆ–å¦å­˜ã€‚</div>
        <textarea id="modalText" spellcheck="false"></textarea>
      </div>
      <div class="modalFt">
        <button class="primary" id="modalCopy">ä¸€éµè¤‡è£½ï¼ˆå‚™æ´ï¼‰</button>
        <button id="modalSelect">å…¨é¸</button>
      </div>
    </div>
  </div>

<script>
  // ---------- Config ----------
  const cfg = {
    pos: ["é†«ç¾å‹å–„ï¼ˆéé†«ç™‚ï¼‰","æ²™é¾å°ˆæ¥­","é«˜ç«¯ç²¾å“","æº«å’Œæ•å¼±","è‡ªç„¶æ¤èƒ","ç§‘æŠ€æ„Ÿï¼ˆå…‹åˆ¶ï¼‰","è¦ªæ°‘æ—¥å¸¸","æ¥µç°¡ç•™ç™½"],
    channel: ["æ²™é¾ B2B","å®˜ç¶²é›»å•†","é†«ç¾è¨ºæ‰€é€šè·¯","è—¥å±€ / é€šè·¯","ç›´æ’­åœ˜è³¼","ç™¾è²¨å°ˆæ«ƒ"],
    pack: ["åœ“ç“¶","æ–¹ç“¶","æ»´ç®¡","æŒ‰å£“ç“¶","å™´éœ§","å®‰ç“¶","è»Ÿç®¡","ç½è£"],
    mat: ["éœ§é¢å¡‘æ–™","é€æ˜å¡‘æ–™","ç»ç’ƒ","éœ§é¢ç»ç’ƒ","é‡‘å±¬è³ªæ„Ÿï¼ˆå±€éƒ¨ï¼‰","ç´™ç›’å¤–åŒ…è£","ç’°ä¿æè³ªæ„Ÿ"],
    color: ["è±¡ç‰™ç™½","éœ§é‡‘","é»‘é‡‘","ç±³ç™½","æ·¡ç¶ ","æ·¡é»ƒ","éœ§ç°","æ·±è—","ç«ç‘°é‡‘","è£¸ç²‰","é€æ˜æ„Ÿ"],
    mood: ["å°ˆæ¥­å¯ä¿¡","ä¹¾æ·¨ç´”æ·¨","æº«æŸ”è¦ªè†š","ä½èª¿å¥¢è¯","è‡ªç„¶æ¸…æ–°","ç†æ€§å…‹åˆ¶","é«˜ç´šæ„Ÿ","ç™‚ç™’æ„Ÿ","æœ‰åŠ›é‡ï¼ˆä½†ä¸ä¾µç•¥ï¼‰"],
    type: ["ç¾ä»£ç„¡è¥¯ç·š","ç´°å­—æ¥µç°¡","é«˜ç´šè¥¯ç·š","ç†æ€§æ ¼ç·šæ’ç‰ˆ","å¤§ç•™ç™½ï¼‹å°å­—","è³‡è¨Šæ¸…æ™°å°å‘"],
    visual: ["æŠ½è±¡å…‰æ„Ÿ","ç·šæ¢æµå‹•","æ¤ç‰©æ„è±¡ï¼ˆæŠ½è±¡ï¼‰","å¹¾ä½•ç§‘æŠ€æ„Ÿï¼ˆä½èª¿ï¼‰","æ°´æ„Ÿé€æ˜å±¤æ¬¡","ç„¡åœ–åƒï¼ˆç´”æ’ç‰ˆï¼‰"],
    avoid: ["éåº¦é†«ç™‚å™¨æ¢°æ„Ÿ","éåº¦ä¿ƒéŠ·é›»å•†æ„Ÿ","éåº¦å°‘å¥³å¯æ„›","å¤ªèŠ±å¤ªæ»¿","å»‰åƒ¹é‡‘å…‰é–ƒäº®","å¼·çƒˆå°æ¯”åˆºçœ¼"]
  };

  // contradiction & risk heuristics (simple but useful)
  function evaluateRisk(sel){
    let score = 0;
    const warns = [];

    const has = (arr, key) => arr.includes(key);

    // Contradictions
    if (has(sel.mood,"ä½èª¿å¥¢è¯") && has(sel.pos,"è¦ªæ°‘æ—¥å¸¸")) { score+=2; warns.push("åŒæ™‚é¸åˆ°ã€Œä½èª¿å¥¢è¯ã€èˆ‡ã€Œè¦ªæ°‘æ—¥å¸¸ã€ï¼Œå»ºè­°å…ˆæ±ºå®šåƒ¹æ ¼å¸¶èˆ‡é€šè·¯èªè¨€ã€‚"); }
    if (has(sel.color,"é»‘é‡‘") && has(sel.avoid,"å»‰åƒ¹é‡‘å…‰é–ƒäº®")===false && has(sel.mood,"ä½èª¿å¥¢è¯")) { score+=1; warns.push("é»‘é‡‘åšå¾—å¥½æ˜¯ç²¾å“ï¼›åšä¸å¥½å°±æ˜¯KTVã€‚å»ºè­°é–å®šã€éœ§é‡‘ï¼‹ç•™ç™½ã€ï¼Œé¿å…äº®é¢å¤§é¢ç©é‡‘è‰²ã€‚"); }
    if (has(sel.pos,"ç§‘æŠ€æ„Ÿï¼ˆå…‹åˆ¶ï¼‰") && has(sel.mood,"è‡ªç„¶æ¸…æ–°")) { score+=1; warns.push("ç§‘æŠ€æ„Ÿèˆ‡è‡ªç„¶æ„Ÿå¯ä»¥å…±å­˜ï¼Œä½†éœ€è¦ã€æŠ½è±¡æ¤ç‰©ï¼‹ç†æ€§æ’ç‰ˆã€ä¾†å¹³è¡¡ã€‚"); }

    // Compliance hints
    const ing = (sel.ing||"").toLowerCase();
    if (ing.includes("å¤–æ³Œé«”") || ing.includes("å¹¹ç´°èƒ") || ing.includes("exosome") || ing.includes("stem")) {
      score+=2; warns.push("æˆåˆ†æåˆ°å¤–æ³Œé«”/å¹¹ç´°èƒç›¸é—œå­—æ¨£ï¼šè«‹å‹™å¿…èµ°ä½ å€‘çš„åˆè¦å¯©æ ¸èˆ‡å®£ç¨±é¢¨éšªæ§ç®¡ï¼ˆé¿å…é†«ç™‚æš—ç¤ºï¼‰ã€‚");
    }
    if (has(sel.avoid,"éåº¦é†«ç™‚å™¨æ¢°æ„Ÿ")===false && has(sel.pos,"é†«ç¾å‹å–„ï¼ˆéé†«ç™‚ï¼‰")) {
      score+=1; warns.push("é¸äº†ã€é†«ç¾å‹å–„ã€ä½†æœªå‹¾ã€é¿å…é†«ç™‚å™¨æ¢°æ„Ÿã€ï¼šå®¹æ˜“åœ¨è¦–è¦ºä¸Šè¸©ç·šï¼Œå»ºè­°åŠ ä¸Šã€é¿å…é†«ç™‚å™¨æ¢°æ„Ÿã€ã€‚");
    }

    // Output category
    let level = "good";
    if (score >= 4) level = "bad";
    else if (score >= 2) level = "warn";

    return {score, level, warns};
  }

  // ---------- UI helpers ----------
  function makeChips(containerId, items){
    const el = document.getElementById(containerId);
    el.innerHTML = "";
    items.forEach(txt=>{
      const c = document.createElement("div");
      c.className = "chip";
      c.textContent = txt;
      c.onclick = ()=>{ c.classList.toggle("on"); updateAll(); };
      el.appendChild(c);
    });
  }

  function getSelected(containerId){
    return [...document.querySelectorAll(`#${containerId} .chip.on`)].map(x=>x.textContent);
  }

  function setSelected(containerId, arr){
    document.querySelectorAll(`#${containerId} .chip`).forEach(ch=>{
      ch.classList.toggle("on", arr.includes(ch.textContent));
    });
  }

  function kvRow(k,v){
    const d1 = document.createElement("div"); d1.textContent = k;
    const d2 = document.createElement("div"); d2.textContent = v || "â€”";
    return [d1,d2];
  }

  function buildPrompt(sel){
    const pos = sel.pos.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const channel = sel.channel.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const pack = sel.pack.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const mat = sel.mat.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const color = sel.color.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const mood = sel.mood.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const type = sel.type.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const visual = sel.visual.join("ã€") || "ï¼ˆæœªé¸ï¼‰";
    const avoid = sel.avoid.join("ã€") || "ï¼ˆæœªé¸ï¼‰";

    return `è«‹ç”Ÿæˆä¸€çµ„ã€ŒåŒ–å¦å“ OEM åŒ…è£è¦–è¦ºæ–¹å‘ã€ä½œç‚ºè¨­è¨ˆææ¡ˆåƒè€ƒï¼ˆéæ’ç•«ã€éœ€å…·é‡ç”¢å¯è¡Œæ„Ÿï¼‰ã€‚

ã€åŸºæœ¬è³‡æ–™ã€‘
å“ç‰Œ/å°ˆæ¡ˆï¼š${sel.brand || "ï¼ˆæœªå¡«ï¼‰"}
ç”¢å“é¡å‹ï¼š${sel.ptype}
ç›®æ¨™å®¢ç¾¤ï¼š${sel.aud || "ï¼ˆæœªå¡«ï¼‰"}
é€šè·¯ï¼š${channel}
å“ç‰Œå®šä½ï¼š${pos}

ã€åŒ…è£åå¥½ã€‘
åŒ…è£å½¢å¼ï¼š${pack}
æè³ªåå¥½ï¼š${mat}
è‰²ç³»åå¥½ï¼š${color}
è³ªæ„Ÿ/æ°›åœï¼š${mood}
å­—é«”/æ’ç‰ˆï¼š${type}
åœ–åƒèªè¨€ï¼š${visual}

ã€æƒ³é¿å…çš„é¢¨æ ¼ã€‘
${avoid}

ã€æˆåˆ†/ç§‘æŠ€å½¢è±¡ï¼ˆå¦‚éœ€ï¼‰ã€‘
${sel.ing || "ï¼ˆæœªå¡«ï¼‰"}

ã€è£œå……å‚™è¨»ã€‘
${sel.note || "ï¼ˆæœªå¡«ï¼‰"}

ã€ç¡¬æ€§è¦ç¯„ã€‘
- è¦–è¦ºéœ€å‘ˆç¾å°ˆæ¥­ã€ä¹¾æ·¨ã€å¯ä¿¡ä»»
- é¿å…é†«ç™‚å™¨æ¢°æ„Ÿã€æ²»ç™‚æš—ç¤ºã€ç™‚æ•ˆèª‡å¼µ
- å¯ç›´æ¥ç”¨æ–¼ OEM ææ¡ˆèˆ‡è¨­è¨ˆ brief å°é½Š
- ä»¥å•†æ¥­ç”¢å“æ”å½±/åŒ…è£è¨­è¨ˆèªè¨€å‘ˆç¾ï¼šæ¸…æ™°æ¯”ä¾‹ã€åˆç†æè³ªã€å¯é‡ç”¢å°åˆ·æ„Ÿ
`;
  }

  function buildMarkdown(sel, risk){
    const bullets = (arr)=> arr.length ? arr.map(x=>`- ${x}`).join("\n") : "- â€”";
    const warns = risk.warns.length ? risk.warns.map(w=>`- âš ï¸ ${w}`).join("\n") : "- âœ… ç›®å‰ç„¡æ˜é¡¯è¡çª";
    return `# åŒ–å¦å“ OEMï½œåŒ…è£åå¥½ Briefï¼ˆæ¥­ä¸»å¡«å¯«ç‰ˆï¼‰

**å“ç‰Œ/å°ˆæ¡ˆ**ï¼š${sel.brand || "â€”"}  
**ç”¢å“é¡å‹**ï¼š${sel.ptype}  
**ç›®æ¨™å®¢ç¾¤**ï¼š${sel.aud || "â€”"}  

## 1) å®šä½èˆ‡é€šè·¯
**å“ç‰Œå®šä½**  
${bullets(sel.pos)}

**é€šè·¯**  
${bullets(sel.channel)}

## 2) åŒ…è£åå¥½
**åŒ…è£å½¢å¼**  
${bullets(sel.pack)}

**æè³ªåå¥½**  
${bullets(sel.mat)}

**è‰²ç³»åå¥½**  
${bullets(sel.color)}

**è³ªæ„Ÿ/æ°›åœ**  
${bullets(sel.mood)}

**å­—é«”/æ’ç‰ˆ**  
${bullets(sel.type)}

**åœ–åƒèªè¨€**  
${bullets(sel.visual)}

## 3) é¿å…é …
${bullets(sel.avoid)}

## 4) æˆåˆ†/ç§‘æŠ€å½¢è±¡ï¼ˆå¦‚éœ€ï¼‰
${sel.ing || "â€”"}

## 5) è£œå……å‚™è¨»
${sel.note || "â€”"}

---

## 6) é¢¨éšªæé†’ï¼ˆä¸€è‡´æ€§/åˆè¦/æ–¹å‘ï¼‰
${warns}

---

## 7) GEMINI CANVAS Prompt
\`\`\`
${buildPrompt(sel).trim()}
\`\`\`
`;
  }

  function collect(){
    return {
      brand: document.getElementById("brand").value.trim(),
      ptype: document.getElementById("ptype").value,
      aud: document.getElementById("aud").value.trim(),
      ing: document.getElementById("ing").value.trim(),
      note: document.getElementById("note").value.trim(),
      pos: getSelected("posChips"),
      channel: getSelected("channelChips"),
      pack: getSelected("packChips"),
      mat: getSelected("matChips"),
      color: getSelected("colorChips"),
      mood: getSelected("moodChips"),
      type: getSelected("typeChips"),
      visual: getSelected("visualChips"),
      avoid: getSelected("avoidChips"),
    };
  }

  function updateAll(){
    const sel = collect();
    const risk = evaluateRisk(sel);

    // brief kv
    const kv = document.getElementById("briefKv");
    kv.innerHTML = "";
    const items = [
      ["å“ç‰Œ/å°ˆæ¡ˆ", sel.brand],
      ["ç”¢å“é¡å‹", sel.ptype],
      ["ç›®æ¨™å®¢ç¾¤", sel.aud],
      ["é€šè·¯", sel.channel.join("ã€")],
      ["å®šä½", sel.pos.join("ã€")],
      ["åŒ…è£å½¢å¼", sel.pack.join("ã€")],
      ["æè³ª", sel.mat.join("ã€")],
      ["è‰²ç³»", sel.color.join("ã€")],
      ["æ°›åœ", sel.mood.join("ã€")],
      ["å­—é«”/æ’ç‰ˆ", sel.type.join("ã€")],
      ["åœ–åƒèªè¨€", sel.visual.join("ã€")],
      ["é¿å…é …", sel.avoid.join("ã€")],
      ["æˆåˆ†å½¢è±¡", sel.ing],
    ];
    items.forEach(([k,v])=>{
      kv.append(...kvRow(k, v));
    });

    // risk UI
    const dot = document.getElementById("riskDot");
    const title = document.getElementById("riskTitle");
    const msg = document.getElementById("riskMsg");
    dot.className = "dot " + risk.level;

    if (risk.level === "good"){
      title.textContent = "é¢¨éšªç‹€æ…‹ï¼šè‰¯å¥½ï¼ˆå¯é€²å…¥ææ¡ˆï¼‰";
      msg.textContent = "é¸é …æ•´é«”ä¸€è‡´ï¼›æ¥ä¸‹ä¾†å¯ç”¨å³å´ Prompt ç›´æ¥ç”¢å‡ºè¦–è¦ºæ–¹å‘åœ–ã€‚";
    } else if (risk.level === "warn"){
      title.textContent = "é¢¨éšªç‹€æ…‹ï¼šéœ€å°é½Šï¼ˆå»ºè­°å…ˆæ”¶æ–‚ï¼‰";
      msg.textContent = risk.warns[0] || "éƒ¨åˆ†é¸é …å¯èƒ½äº’æ–¥ï¼Œå»ºè­°å…ˆç¢ºå®šå®šä½èˆ‡é€šè·¯èªè¨€ã€‚";
    } else {
      title.textContent = "é¢¨éšªç‹€æ…‹ï¼šé«˜ï¼ˆå¾ˆå¯èƒ½è¿”å·¥ï¼‰";
      msg.textContent = (risk.warns[0] || "ç›®å‰é¸é …è¡çªè¼ƒå¤šï¼Œå»ºè­°å…ˆåš 15 åˆ†é˜å®šä½æ±ºç­–å†é€²å…¥è¨­è¨ˆã€‚");
    }

    // prompt + markdown
    document.getElementById("promptOut").textContent = buildPrompt(sel).trim();
    document.getElementById("mdOut").textContent = buildMarkdown(sel, risk).trim();
  }

  function download(filename, text){
    // Some environments (embedded preview / iOS / sandbox) may block programmatic download.
    // We still attempt it, then also provide a manual fallback modal.
    try{
      const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.rel = "noopener";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 800);
      return true;
    }catch(e){
      return false;
    }
  }

  // ---------- Modal helpers (fallback) ----------
  const overlay = document.getElementById("modalOverlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalHelp = document.getElementById("modalHelp");
  const modalText = document.getElementById("modalText");
  const modalClose = document.getElementById("modalClose");
  const modalCopy = document.getElementById("modalCopy");
  const modalSelect = document.getElementById("modalSelect");

  function openModal(title, help, text){
    modalTitle.textContent = title;
    modalHelp.textContent = help;
    modalText.value = text;
    overlay.style.display = "flex";
    overlay.setAttribute("aria-hidden","false");
    // focus & select for fast copy
    setTimeout(()=>{ modalText.focus(); modalText.select(); }, 50);
  }
  function closeModal(){
    overlay.style.display = "none";
    overlay.setAttribute("aria-hidden","true");
  }

  function legacyCopy(text){
    // Works in more restricted browsers where navigator.clipboard is blocked.
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.top = '-9999px';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    let ok = false;
    try{ ok = document.execCommand('copy'); }catch(e){ ok = false; }
    ta.remove();
    return ok;
  }

  async function tryCopy(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      // fallback
      return legacyCopy(text);
    }
  }

  modalClose.onclick = closeModal;
  overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeModal(); });
  modalSelect.onclick = ()=>{ modalText.focus(); modalText.select(); };
  modalCopy.onclick = async ()=>{
    const ok = await tryCopy(modalText.value);
    alert(ok ? "å·²è¤‡è£½ âœ…" : "è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹• Ctrl/Cmd+C");
  };
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

  // ---------- Init ----------
  makeChips("posChips", cfg.pos);
  makeChips("channelChips", cfg.channel);
  makeChips("packChips", cfg.pack);
  makeChips("matChips", cfg.mat);
  makeChips("colorChips", cfg.color);
  makeChips("moodChips", cfg.mood);
  makeChips("typeChips", cfg.type);
  makeChips("visualChips", cfg.visual);
  makeChips("avoidChips", cfg.avoid);

  ["brand","ptype","aud","ing","note"].forEach(id=>{
    document.getElementById(id).addEventListener("input", updateAll);
    document.getElementById(id).addEventListener("change", updateAll);
  });

  document.getElementById("btnReset").onclick = ()=>{
    document.getElementById("brand").value="";
    document.getElementById("aud").value="";
    document.getElementById("ing").value="";
    document.getElementById("note").value="";
    ["posChips","channelChips","packChips","matChips","colorChips","moodChips","typeChips","visualChips","avoidChips"]
      .forEach(cid=> setSelected(cid, []));
    updateAll();
  };

  document.getElementById("btnSample").onclick = ()=>{
    document.getElementById("brand").value="ï¼ˆç¤ºç¯„ï¼‰æ²™é¾é«˜ç«¯è­·ç†ç³»åˆ—";
    document.getElementById("ptype").value="é ­çš®ç²¾è¯";
    document.getElementById("aud").value="æ²™é¾å°ˆæ¥­äººå£«ï¼é‡è¦–é ­çš®ç®¡ç†çš„æ¶ˆè²»è€…";
    document.getElementById("ing").value="æ¤èƒã€èƒœè‚½ï¼ˆåˆè¦ç”¨èªç‚ºä¸»ï¼‰";
    document.getElementById("note").value="å¸Œæœ›æœ‰é†«ç¾å‹å–„çš„ä¿¡ä»»æ„Ÿï¼Œä½†ä¸è¦é†«ç™‚å™¨æ¢°æ„Ÿï¼›åç•™ç™½ã€éœ§é¢ã€ä½èª¿å¥¢è¯ã€‚";
    setSelected("posChips", ["æ²™é¾å°ˆæ¥­","é«˜ç«¯ç²¾å“","æ¥µç°¡ç•™ç™½"]);
    setSelected("channelChips", ["æ²™é¾ B2B","å®˜ç¶²é›»å•†"]);
    setSelected("packChips", ["æ»´ç®¡","åœ“ç“¶"]);
    setSelected("matChips", ["éœ§é¢ç»ç’ƒ","ç´™ç›’å¤–åŒ…è£"]);
    setSelected("colorChips", ["è±¡ç‰™ç™½","éœ§é‡‘","éœ§ç°"]);
    setSelected("moodChips", ["å°ˆæ¥­å¯ä¿¡","ä½èª¿å¥¢è¯","ç†æ€§å…‹åˆ¶","é«˜ç´šæ„Ÿ"]);
    setSelected("typeChips", ["ç´°å­—æ¥µç°¡","å¤§ç•™ç™½ï¼‹å°å­—"]);
    setSelected("visualChips", ["æŠ½è±¡å…‰æ„Ÿ","ç·šæ¢æµå‹•"]);
    setSelected("avoidChips", ["éåº¦é†«ç™‚å™¨æ¢°æ„Ÿ","éåº¦ä¿ƒéŠ·é›»å•†æ„Ÿ","å»‰åƒ¹é‡‘å…‰é–ƒäº®"]);
    updateAll();
  };

  document.getElementById("btnExport").onclick = ()=>{
    const sel = collect();
    const risk = evaluateRisk(sel);
    const md = buildMarkdown(sel, risk);
    const safeName = (sel.brand || "OEM_Packaging_Brief").replace(/[\/:*?"<>|]+/g,"_");

    const ok = download(`${safeName}_Brief.md`, md);

    // Always offer a manual fallback (some previews block downloads)
    if(!ok){
      openModal(
        "Markdown å ±å‘Šï¼ˆä¸‹è¼‰å—é™å‚™æ´ï¼‰",
        "æ­¤ç’°å¢ƒå¯èƒ½é™åˆ¶ä¸‹è¼‰ã€‚ä½ å¯ä»¥ç›´æ¥è¤‡è£½å…§å®¹ï¼Œè²¼åˆ° Notion / Google Doc / æª”æ¡ˆå¦å­˜ç‚º .mdã€‚",
        md
      );
    } else {
      // Even if download is attempted, still helpful to show a copy-friendly modal on restricted platforms.
      // Comment out if you don't want it.
      // openModal("Markdown å ±å‘Šï¼ˆå¯è¤‡è£½å‚™æ´ï¼‰","è‹¥ä¸‹è¼‰æ²’æœ‰åæ‡‰ï¼Œè«‹åœ¨æ­¤æ‰‹å‹•è¤‡è£½å¦å­˜ã€‚", md);
    }
  };

  document.getElementById("btnCopyPrompt").onclick = async ()=>{
    const text = document.getElementById("promptOut").textContent;
    const ok = await tryCopy(text);
    if(ok){
      alert("å·²è¤‡è£½ GEMINI CANVAS Prompt âœ…");
    }else{
      // Hard fallback: show modal so user can Ctrl/Cmd+C
      openModal(
        "GEMINI CANVAS Promptï¼ˆè¤‡è£½å—é™å‚™æ´ï¼‰",
        "æ­¤ç’°å¢ƒå¯èƒ½é™åˆ¶å‰ªè²¼ç°¿ã€‚è«‹åœ¨æ­¤å…¨é¸å¾Œ Ctrl/Cmd+C è¤‡è£½ã€‚",
        text
      );
    }
  };

  updateAll();
</script>
</body>
</html>
